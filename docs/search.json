[
  {
    "objectID": "introduction.html",
    "href": "introduction.html",
    "title": "Background",
    "section": "",
    "text": "In recent years, there has been an increasing demand for detailed disaggregated data at small geographical levels. The growing interest in subnational spatial units such as cities, neighbourhoods, and other small areas requires more granular data than what is typically available. This detailed information is essential for making informed policy decisions and effectively monitoring specific goals. For example, fields like poverty mapping, income estimation, health statistics, or environmental monitoring often require reliable estimates of subpopulations or domains where samples are too small or even non-existent Lahiri (2006). This can cause severe problems when trying to draw conclusions about these small areas.\nTraditionally, the way of obtaining information about an area involves the use of sample surveys. Survey sampling consists of selecting an \\(n\\) number of observations from a finite population of \\(N\\) individuals and using the sample to draw conclusions about the entire population (Chambers 2011). Typically, these surveys allow for generating estimates for the total population and, usually, some specific domains. However, many times analysts need to make estimates for areas that are different from the predefined survey domains. What usually happens is that the sample sizes of these desired areas are either too small or even non-existent, which causes serious problems when trying to draw reliable estimators (Morales et al. 2021). This is because the small population sizes of these domains derive in unacceptably large standard errors, making the estimators unreliable (Ghosh and Rao 1994).\nThis section will provide the necessary background information to understand what SAE is and why it is necessary for overcoming the limitations associated with traditional sample-based estimations.\n\n\nSmall area estimation (SAE) is a statistical technique for producing reliable information for small groups or regions when regular survey data does not provide enough information. This methodology combines existing survey data with auxiliary information –such as census data, or other appropriate indicators– to improve the estimates[^An estimate is an educated guess on the approximate value of a variable based on available data.] for our variable of interest.\nTraditionally, one way to generate an estimate is using the sample information to draw conclusions about the whole population. This can be done by simply suming the sample values of the variable of interest –target variable– and multiply it by the sample weights (Horvitz and Thompson 1952). Methods that only use smaple data to generate estimates about the target variable are known as direct estimators. Direct methods pose a series of advantages, such as their simplicity and intuitive calculation or the lack of dependance on external data sources. However, the very qualities that make these estimators attractive are also their greatest limitations. Since they rely only on sample data, their accuracy is directly linked to the sample’s size and representativeness, a challenge that is not always easy to solve.\nTo exemplify the problem, let us assume that we are interested in estimating child malnutrition rates in rural areas. Suppose a national health survey is conducted to assess malnutrition, but the sample size varies across districts. In urban centers, where more data is collected, direct estimators can provide reasonably accurate and stable estimates. However, in rural districts with smaller sample sizes, the same method produces highly unstable estimates, making it difficult to determine whether a district truly has higher or lower malnutrition rates or if the observed differences are simply due to random variation. This lack of reliability poses a serious challenge for policymakers and organizations that need precise data to allocate resources effectively. In such cases, alternative methods are needed to improve these estimates, allowing for more robust and stable results even when direct survey data is limited.\n\n\n\nThe main challenge that justifies the use of small area estimation (SAE) over traditional survey-based methods is the lack of sufficiently large sample sizes. In the previous example, authorities sought to obtain a more detailed understanding of malnutrition rates among children in rural areas. However, for some districts, the available sample sizes were too small to yield reliable estimates, leading to high uncertainty. To illustrate why small samples can be problematic, we can use a simpler example.\nConsider the probability of getting heads when tossing a fair coin. We know that, in theory, the probability of heads is \\(0.5\\). However, if we only toss the coin a few times, the observed proportion of heads can fluctuate significantly, leading to unstable estimates of the true probability. The smaller the number of tosses, the more random variation we see. To demonstrate this effect, we can simulate what happens as we increase the number of tosses (sample size), using \\(n = (5, 10, 50, 500)\\). By comparing the results, we can see how larger sample sizes reduce variability, producing estimates that are closer to \\(0.5\\), the true probability—just as SAE helps stabilise estimates when working with small datasets.\n\n\n\n\n\n\n\n\n\nIncreasing the sample size is, however, not always viable. The two main reasons for this are the monetary cost and the impracticality of increased samples. Every additional survey response requires more resources –interviewer wages, transportation, data processing, administrative overhead– that sometimes are unavailable. These costs can be even higher if the surveys have to be conducted in remote or hard-to-reach areas. Additionally, if we work with past surveys, increasing the sample size is not possible. It could also be the case that some target populations are difficult to access or are reluctant to provide information. In this cases, sample sizes will also be very limited and difficult to expand.\n\n\n\nSAE methods are designed to improve the efficiency of the estimations derived from direct methods by combining survey sampling methodologies with statistical models. SAE allows for estimating parameters of small subsets –often refered to as small areas or domains– of the original population. These domains can represent either a geographical area or a population subgroup for which the sample is small (Morales et al. 2021).\nContrary to direct estimation methods, SAE improves the quality of the estimates by using data from outside the domain area. This is achieved by identifying similar domains and leveraging their data to improve the estimate for the area of interest, effectively “borrowing strength” from related regions or subpopulations to improve accuracy. SAE can also incorporate information from different time periods as auxiliary data from either the same or a different domain area.\n\n\n\nSAE’s versatility as a statistical methodology has led to its application across multiple fields. National institutes of statistics and other international organisations –UK Office for National Statistics, US Bureau of Census, the Statistical Office of Italy, or the United Nations– rely on this methodology to produce estimates for domains not explicitly included in the sampling design (Kreutzmann et al. 2019). This information is particularly useful for policy making and resource allocation. For instance, in the UK, the Office for National Statistics’ unemployment annual unemployment estimates and the estimates of average income by electoral ward are calculated following this methodology (Office for National Statistics 2023). International organisations such as the World Bank have also applied SAE to estimating poverty rates [@]. With estimates at local level being key for poverty reduction, having information at higher spatial resolution helps policy-makers delivering better targetted policies and resource allocation.\nFinucane et al. (2014) combined a wide range of data soures to estimate trends on health indicators at country, region, and global levels. The methodology used in this study borrows strength in time, age, covariates, and within and across country clusters to generate unbiased estimators in domains where data are sparse.\nBennett et al. (2023) explores the relationship between life expectancy changes at very small area level and housing prices and their evolution.\n\nPoverty mapping\nEducation\nEnvironmental monitoring\n\n\n\n\n\n\n\nSmall area estimation (SAE) is a statistical technique used to generate reliable estimates for geographic or demographic areas (domains) where sample sizes are limited (Morales et al. 2021). This technique has long been used, particularly by demographers interested in estimating population counts and other variables of interest for small areas (John NK Rao and Molina 2015). Applications of SAE to disease mapping by epidemiologists and demographers have been dated back to the eleventh century in England and seventeenth century in Canada (Ghosh and Rao 1994). These primitive small area statistics were primarily based on either census or administrative records, and aimed at complete enumeration, a much more costly approach than nowadays sample survey methods.\n\nIf you are trying to draw a conclusion about a group of people based on your knowledge of just a few of them, chances are you will make a mistake and your conclusions will be wrong. This is what having “unacceptably large standard errors” means.\n\n\nQ1: Why not just increasing the sample size? This would be an easy solution to this problem. However, in most cases expanding the sample is expensive, or even impossible if the analyst is using secondary data.\n\n\n\n\n\nSmall area (or domain): is the geographic area or subpopulation where the data is scarce or even non-existent.\nTarget variable: is the variable of interest for which estimates are being produced.\nEstimator: is a statistical formula used for calculating an unknown population parameter based on sample data.",
    "crumbs": [
      "Introduction to SAE",
      "Background"
    ]
  },
  {
    "objectID": "introduction.html#introduction-to-small-area-estimation",
    "href": "introduction.html#introduction-to-small-area-estimation",
    "title": "Background",
    "section": "",
    "text": "Small area estimation (SAE) is a statistical technique for producing reliable information for small groups or regions when regular survey data does not provide enough information. This methodology combines existing survey data with auxiliary information –such as census data, or other appropriate indicators– to improve the estimates[^An estimate is an educated guess on the approximate value of a variable based on available data.] for our variable of interest.\nTraditionally, one way to generate an estimate is using the sample information to draw conclusions about the whole population. This can be done by simply suming the sample values of the variable of interest –target variable– and multiply it by the sample weights (Horvitz and Thompson 1952). Methods that only use smaple data to generate estimates about the target variable are known as direct estimators. Direct methods pose a series of advantages, such as their simplicity and intuitive calculation or the lack of dependance on external data sources. However, the very qualities that make these estimators attractive are also their greatest limitations. Since they rely only on sample data, their accuracy is directly linked to the sample’s size and representativeness, a challenge that is not always easy to solve.\nTo exemplify the problem, let us assume that we are interested in estimating child malnutrition rates in rural areas. Suppose a national health survey is conducted to assess malnutrition, but the sample size varies across districts. In urban centers, where more data is collected, direct estimators can provide reasonably accurate and stable estimates. However, in rural districts with smaller sample sizes, the same method produces highly unstable estimates, making it difficult to determine whether a district truly has higher or lower malnutrition rates or if the observed differences are simply due to random variation. This lack of reliability poses a serious challenge for policymakers and organizations that need precise data to allocate resources effectively. In such cases, alternative methods are needed to improve these estimates, allowing for more robust and stable results even when direct survey data is limited.",
    "crumbs": [
      "Introduction to SAE",
      "Background"
    ]
  },
  {
    "objectID": "introduction.html#challenges-to-traditional-survey-based-estimation",
    "href": "introduction.html#challenges-to-traditional-survey-based-estimation",
    "title": "Background",
    "section": "",
    "text": "The main challenge that justifies the use of small area estimation (SAE) over traditional survey-based methods is the lack of sufficiently large sample sizes. In the previous example, authorities sought to obtain a more detailed understanding of malnutrition rates among children in rural areas. However, for some districts, the available sample sizes were too small to yield reliable estimates, leading to high uncertainty. To illustrate why small samples can be problematic, we can use a simpler example.\nConsider the probability of getting heads when tossing a fair coin. We know that, in theory, the probability of heads is \\(0.5\\). However, if we only toss the coin a few times, the observed proportion of heads can fluctuate significantly, leading to unstable estimates of the true probability. The smaller the number of tosses, the more random variation we see. To demonstrate this effect, we can simulate what happens as we increase the number of tosses (sample size), using \\(n = (5, 10, 50, 500)\\). By comparing the results, we can see how larger sample sizes reduce variability, producing estimates that are closer to \\(0.5\\), the true probability—just as SAE helps stabilise estimates when working with small datasets.\n\n\n\n\n\n\n\n\n\nIncreasing the sample size is, however, not always viable. The two main reasons for this are the monetary cost and the impracticality of increased samples. Every additional survey response requires more resources –interviewer wages, transportation, data processing, administrative overhead– that sometimes are unavailable. These costs can be even higher if the surveys have to be conducted in remote or hard-to-reach areas. Additionally, if we work with past surveys, increasing the sample size is not possible. It could also be the case that some target populations are difficult to access or are reluctant to provide information. In this cases, sample sizes will also be very limited and difficult to expand.",
    "crumbs": [
      "Introduction to SAE",
      "Background"
    ]
  },
  {
    "objectID": "introduction.html#how-small-area-estimation-helps",
    "href": "introduction.html#how-small-area-estimation-helps",
    "title": "Background",
    "section": "",
    "text": "SAE methods are designed to improve the efficiency of the estimations derived from direct methods by combining survey sampling methodologies with statistical models. SAE allows for estimating parameters of small subsets –often refered to as small areas or domains– of the original population. These domains can represent either a geographical area or a population subgroup for which the sample is small (Morales et al. 2021).\nContrary to direct estimation methods, SAE improves the quality of the estimates by using data from outside the domain area. This is achieved by identifying similar domains and leveraging their data to improve the estimate for the area of interest, effectively “borrowing strength” from related regions or subpopulations to improve accuracy. SAE can also incorporate information from different time periods as auxiliary data from either the same or a different domain area.",
    "crumbs": [
      "Introduction to SAE",
      "Background"
    ]
  },
  {
    "objectID": "introduction.html#real-world-applications-of-sae",
    "href": "introduction.html#real-world-applications-of-sae",
    "title": "Background",
    "section": "",
    "text": "SAE’s versatility as a statistical methodology has led to its application across multiple fields. National institutes of statistics and other international organisations –UK Office for National Statistics, US Bureau of Census, the Statistical Office of Italy, or the United Nations– rely on this methodology to produce estimates for domains not explicitly included in the sampling design (Kreutzmann et al. 2019). This information is particularly useful for policy making and resource allocation. For instance, in the UK, the Office for National Statistics’ unemployment annual unemployment estimates and the estimates of average income by electoral ward are calculated following this methodology (Office for National Statistics 2023). International organisations such as the World Bank have also applied SAE to estimating poverty rates [@]. With estimates at local level being key for poverty reduction, having information at higher spatial resolution helps policy-makers delivering better targetted policies and resource allocation.\nFinucane et al. (2014) combined a wide range of data soures to estimate trends on health indicators at country, region, and global levels. The methodology used in this study borrows strength in time, age, covariates, and within and across country clusters to generate unbiased estimators in domains where data are sparse.\nBennett et al. (2023) explores the relationship between life expectancy changes at very small area level and housing prices and their evolution.\n\nPoverty mapping\nEducation\nEnvironmental monitoring",
    "crumbs": [
      "Introduction to SAE",
      "Background"
    ]
  },
  {
    "objectID": "introduction.html#the-concept-and-its-relevance",
    "href": "introduction.html#the-concept-and-its-relevance",
    "title": "Background",
    "section": "",
    "text": "Small area estimation (SAE) is a statistical technique used to generate reliable estimates for geographic or demographic areas (domains) where sample sizes are limited (Morales et al. 2021). This technique has long been used, particularly by demographers interested in estimating population counts and other variables of interest for small areas (John NK Rao and Molina 2015). Applications of SAE to disease mapping by epidemiologists and demographers have been dated back to the eleventh century in England and seventeenth century in Canada (Ghosh and Rao 1994). These primitive small area statistics were primarily based on either census or administrative records, and aimed at complete enumeration, a much more costly approach than nowadays sample survey methods.\n\nIf you are trying to draw a conclusion about a group of people based on your knowledge of just a few of them, chances are you will make a mistake and your conclusions will be wrong. This is what having “unacceptably large standard errors” means.\n\n\nQ1: Why not just increasing the sample size? This would be an easy solution to this problem. However, in most cases expanding the sample is expensive, or even impossible if the analyst is using secondary data.",
    "crumbs": [
      "Introduction to SAE",
      "Background"
    ]
  },
  {
    "objectID": "introduction.html#key-concepts-of-sae",
    "href": "introduction.html#key-concepts-of-sae",
    "title": "Background",
    "section": "",
    "text": "Small area (or domain): is the geographic area or subpopulation where the data is scarce or even non-existent.\nTarget variable: is the variable of interest for which estimates are being produced.\nEstimator: is a statistical formula used for calculating an unknown population parameter based on sample data.",
    "crumbs": [
      "Introduction to SAE",
      "Background"
    ]
  },
  {
    "objectID": "practical.html",
    "href": "practical.html",
    "title": "Practical",
    "section": "",
    "text": "Now that we have learned the fundamentals of small area estimation (SAE), we will apply these concepts to a real dataset. This practical uses a synthetic population for the North East of England, generated by (Castro et al. 2024). The dataset includes ~1 million individuals in the Tyne and Wear region with demographic and mobility-related attributes. Our goal is to estimate the median income of MSOAs in Tyne and Wear using SAE methods.\n\n\n\nEvaluate the need for SAE through exploratory data analysis.\nImplement different SAE methodologies on synthetic data.\nCompare the performance of different methods.",
    "crumbs": [
      "Practical",
      "Practical"
    ]
  },
  {
    "objectID": "practical.html#practical-in-r-small-area-estimation",
    "href": "practical.html#practical-in-r-small-area-estimation",
    "title": "Practical",
    "section": "",
    "text": "Now that we have learned the fundamentals of small area estimation (SAE), we will apply these concepts to a real dataset. This practical uses a synthetic population for the North East of England, generated by (Castro et al. 2024). The dataset includes ~1 million individuals in the Tyne and Wear region with demographic and mobility-related attributes. Our goal is to estimate the median income of MSOAs in Tyne and Wear using SAE methods.\n\n\n\nEvaluate the need for SAE through exploratory data analysis.\nImplement different SAE methodologies on synthetic data.\nCompare the performance of different methods.",
    "crumbs": [
      "Practical",
      "Practical"
    ]
  },
  {
    "objectID": "practical.html#set-up",
    "href": "practical.html#set-up",
    "title": "Practical",
    "section": "Set-up",
    "text": "Set-up\nLoad the necessary R libraries:\n\nlibrary(emdi)\nlibrary(survey)\nlibrary(SUMMER)\nlibrary(sf)\nlibrary(dplyr)\nlibrary(sfarrow)\nlibrary(ggplot2)\nlibrary(ggspatial)\nlibrary(cowplot)\nlibrary(gridExtra)\nlibrary(reshape2)\nlibrary(spdep)\nlibrary(tidyverse)\nlibrary(viridis)\nlibrary(fastDummies)",
    "crumbs": [
      "Practical",
      "Practical"
    ]
  },
  {
    "objectID": "practical.html#understanding-the-data",
    "href": "practical.html#understanding-the-data",
    "title": "Practical",
    "section": "Understanding the Data",
    "text": "Understanding the Data\nWe use a synthetic population for the Tyne and Wear region. This dataset mimics real-world data while avoiding privacy concerns. Typically, full population data is unavailable, requiring us to work with sample surveys instead.\nFor this workshop, we consider the synthetic population as the ground truth. Our samples are stratified random samples representing subsets of the full population.\n\n# Load sampled data\nsample_1pct &lt;- read.csv(\"./_data/sample_1pct.csv\") # 1% sample\nsample_5pct &lt;- read.csv(\"./_data/sample_5pct.csv\") # 5% sample\nsample_10pct &lt;- read.csv(\"./_data/sample_10pct.csv\") # 10% sample\n\n# Load full synthetic population\nSynthPop_NE_2019 &lt;- read.csv(\"./_data/SynthPop_NE_2019.csv\")\n\n# Load MSOA-level population data\npop &lt;- st_read_parquet(\"./_data/pop_msoa.parquet\")\npop &lt;- st_drop_geometry(pop)\n\n# Preview sample data\nhead(sample_1pct)\n\n    PID_AreaMSOA      HID_AreaOA Area_MSOA   Area_OA Sex Age Ethnic\n1  969_E02001682 80737_E00041816 E02001682 E00041816   1  21      2\n2  899_E02001682 59166_E00041818 E02001682 E00041818   1  20      2\n3 2856_E02001682 76146_E00041822 E02001682 E00041822   1  58      2\n4 5400_E02001682   124_E00041822 E02001682 E00041822   2  31      2\n5  778_E02001682 66807_E00041831 E02001682 E00041831   1  17      2\n6 1019_E02001682 11977_E00041836 E02001682 E00041836   1  22      2\n  Marital_status Children_dependency Economic_activity Occupation Income\n1         Single               FALSE          Employed          6  11310\n2         Single               FALSE          Employed          4   8410\n3        Married               FALSE          Employed          8  27950\n4        Married               FALSE          Employed          2  25970\n5         Single               FALSE        Unemployed          2  10040\n6         Single               FALSE          Employed          7   9900\n  Driving_license Car_access Bike_access weight\n1            TRUE      FALSE        TRUE     66\n2            TRUE       TRUE       FALSE     61\n3            TRUE      FALSE       FALSE     70\n4            TRUE       TRUE        TRUE     62\n5           FALSE      FALSE        TRUE     60\n6            TRUE       TRUE       FALSE     65\n\n\n\n\nData Coverage and Exploratory Analysis\nSurvey samples contain only a fraction of the population, which can lead to regions with low or missing observations, making estimates unreliable. Let’s analyze our sample distribution across MSOAs:\n\n\n\n\n\n\n\n\n\nWe see that some MSOAs have very few observations, making direct estimates unreliable.",
    "crumbs": [
      "Practical",
      "Practical"
    ]
  },
  {
    "objectID": "practical.html#direct-estimator",
    "href": "practical.html#direct-estimator",
    "title": "Practical",
    "section": "Direct Estimator",
    "text": "Direct Estimator\nTo generate a direct estimator for Income we will apply the Horovitz-Thompson estimator, which\nIf we do not add sample weights to the estimator, we obtain a naive direct estimator.\n\n# Naive direct estimator -- Without considering survey weigths\nnaive &lt;- sae::direct(y = sample_1pct$Income,\n                     dom = sample_1pct$Area_MSOA,\n                     domsize = pop)\n\nWe can also consider survey weights to generate a weighted direct estimator.\n\n# Weighted direct estimator -- Adding survey weigths\nweighted &lt;- sae::direct(y = sample_1pct$Income,\n                     dom = sample_1pct$Area_MSOA, \n                     sweight = sample_1pct$weight, # We add weights\n                     domsize = pop)\n\n\n\nSaving 7 x 5 in image\n\n\nWarning: Removed 30 rows containing non-finite outside the scale range\n(`stat_density()`).\n\n\n\n\nSaving 7 x 5 in image",
    "crumbs": [
      "Practical",
      "Practical"
    ]
  },
  {
    "objectID": "practical.html#smoothed-estimators",
    "href": "practical.html#smoothed-estimators",
    "title": "Practical",
    "section": "Smoothed Estimators",
    "text": "Smoothed Estimators\nSmoothed estimators borrow information from other areas to improve estimates for low-sample regions.\n\n# Prepare population data\nsample_1pct$pop &lt;- sum(pop$population[match(sample_1pct$Area_MSOA, pop$MSOA11CD)])\n\n# Survey design\ndesign &lt;- survey::svydesign(ids = ~1,\n                            weights = ~weight,\n                            data = sample_1pct,\n                            fpc = ~pop)\n\n# Direct estimator using `SUMMER`\nsmooth &lt;- smoothArea(formula = Income~1,\n                 domain = ~Area_MSOA,\n                 design = design,\n                 domain.size = pop %&gt;% st_drop_geometry(),\n                 return.samples = T)\n\n# Make table\ndf &lt;- data.frame(Area_MSOA = smooth$direct.est$domain,\n           direct = smooth$direct.est$median,\n           smoothed = smooth$iid.model.est$mean,\n           se_direct = sqrt(smooth$direct.est$var),\n           se_smoothed = sqrt(smooth$iid.model.est$var)) %&gt;% \n  pivot_longer(cols = c(direct, smoothed, se_direct, se_smoothed), \n               names_to = \"estimate_type\", \n               values_to = \"estimate_value\")\n\n\n# Add coordinates for mapping\ndf &lt;- merge(df, msoa_geo, by.x = \"Area_MSOA\", by.y = \"MSOA11CD\") %&gt;%\n  st_as_sf()\n\n# Map\nm &lt;- ggplot() +\n  geom_sf(data = df, aes(fill = estimate_value, colour = estimate_value)) +\n  scale_fill_viridis_c(option = \"magma\", name = \"GBP\", direction = 1) +\n  scale_colour_viridis_c(option = \"magma\", name = \"GBP\", direction = 1) +\n  facet_wrap(~estimate_type, nrow = 1) +\n  theme_map()\n\nggsave(plot = m, filename = \"./_figures/smooth_maps.png\")\n\nSaving 7 x 5 in image",
    "crumbs": [
      "Practical",
      "Practical"
    ]
  },
  {
    "objectID": "practical.html#area-based-estimators",
    "href": "practical.html#area-based-estimators",
    "title": "Practical",
    "section": "Area-Based Estimators",
    "text": "Area-Based Estimators\nWe incorporate spatial dependencies into the model using an adjacency matrix.\n\n# We want to incorporate a spatial element into our model\n# We need to know which regions are close to each other\n# Therefore, we generate an adjacency matrix\nmat &lt;- nb2mat(poly2nb(msoa_geo), style = \"B\")\n\n# Set column and row names to adjacency matrix\ncolnames(mat) &lt;- rownames(mat) &lt;- msoa_geo$MSOA11CD\n\n# Make sure there is no mismatch between the areas in the adjacency matrix and those in the design\ncommon_areas &lt;- intersect(rownames(mat), unique(design$variables$Area_MSOA))\nmat &lt;- mat[common_areas,common_areas]\n\n# Direct estimator using `SUMMER`\narea_based &lt;- smoothArea(formula = Income~1,\n                 domain = ~Area_MSOA,\n                 design = design,\n                 adj.mat = mat)\n\n\n# Add covariates to enrich the model\nXmat &lt;- aggregate(Age~Area_MSOA, data = sample_1pct, FUN = mean)\n\n# Estimate model with covariates\narea_based_covar &lt;- smoothArea(Income ~ Age,\n                       domain = ~Area_MSOA,\n                       design = design,\n                       adj.mat = mat,\n                       X.domain = Xmat)\n\n\nlength(unique(sample_1pct$Area_MSOA))\n\n[1] 325\n\nlength(unique(SynthPop_NE_2019$Area_MSOA))\n\n[1] 340\n\nnrow(area_based_covar$direct.est)\n\n[1] 325\n\nncol(mat)\n\n[1] 325\n\n\n\n# Convert covariates to dummies\ncensus_covars &lt;- dummy_cols(SynthPop_NE_2019, select_columns = c('Sex', 'Ethnic', 'Marital_status','Children_dependency','Economic_activity','Economic_activity'), remove_first_dummy = T, remove_selected_columns = T)\n\n# Create covariates to enrich the model\nX_mat &lt;- aggregate(cbind(Age, Sex_2, Ethnic_4, Ethnic_6, Ethnic_8, Marital_status_Single,Children_dependency_TRUE) ~ Area_MSOA, data = census_covars, FUN = mean)\n\n# Estimate model with covariates\n# area_based_covar &lt;- smoothArea(Income ~ Age + Sex_2,\n#                        domain = ~Area_MSOA,\n#                        design = design,\n#                        adj.mat = mat,\n#                        X.domain = X_mat)\n\n\n# Prepare comparison plots\n## Direct estimator -- Area-based with covariates\ndirect_area_based_covar &lt;- area_based_covar$direct.est %&gt;% \n  dplyr::select(domain, median) %&gt;% \n  rename(Area_MSOA = domain) %&gt;% \n  mutate(source = \"direct\")\n\n## IID model -- Area-based with covariates\niid_area_based_covar &lt;- area_based_covar$iid.model.est %&gt;% \n  dplyr::select(domain, median) %&gt;% \n  rename(Area_MSOA = domain) %&gt;% \n  mutate(source = \"iid\")\n\n## BYM2 model -- Area-based with covariates\nbym2_area_based_covar &lt;- area_based_covar$bym2.model.est %&gt;% \n  dplyr::select(domain, median) %&gt;% \n  rename(Area_MSOA = domain) %&gt;% \n  mutate(source = \"bym2\")\n\n## Bind rows\ncombined_estimates &lt;- bind_rows(direct_area_based_covar, bym2_area_based_covar, iid_area_based_covar)\n\n## Filter populations values that are not in estimates\nfiltered_benchmark_population &lt;- benchmark_population %&gt;% filter(Area_MSOA %in% direct_area_based_covar$Area_MSOA)\n\n## Merge everything together\nplot_data &lt;- combined_estimates %&gt;%\n  left_join(benchmark_population %&gt;% select(Area_MSOA, median), by = \"Area_MSOA\") %&gt;%\n  rename(benchmark_median = median.y, estimate_median = median.x)\n\n# Scatter plot\nggplot(plot_data, aes(x = benchmark_median, y = estimate_median, color = source)) +\n  geom_point(alpha = 0.7) +\n  geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"black\") +  # 45-degree reference line\n  labs(\n    x = \"Benchmark Population Median\",\n    y = \"Model Estimates Median\",\n    color = \"Source\",\n    title = \"Comparison of Model Estimates vs Benchmark Population\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n# Density functions\ncombined_estimates &lt;- bind_rows(direct_area_based_covar, bym2_area_based_covar, iid_area_based_covar, benchmark_population)\n\np &lt;- ggplot() +\n  geom_density(data = combined_estimates, aes(x = median, fill = source), alpha = .7) +\n  scale_fill_manual(values = c(\"#e07a5f\",\"#3d405b\",\"#81b29a\",\"#f2cc8f\")) +\n  theme_minimal()\nggsave(plot = p, filename = \"./_figures/area-level-density.png\")\n\nSaving 7 x 5 in image\n\n\n\ngdf &lt;- merge(combined_estimates, msoa_geo, by.x = \"Area_MSOA\", by.y = \"MSOA11CD\") %&gt;% \n  st_as_sf()\n\nm &lt;- ggplot() +\n  geom_sf(data = gdf, aes(fill = median, colour = median)) +\n  scale_fill_viridis_c(option = \"magma\", name = \"GBP\", direction = 1) +\n  scale_colour_viridis_c(option = \"magma\", name = \"GBP\", direction = 1) +\n  facet_wrap(~source, nrow = 1) +\n  theme_map()\nggsave(plot = m, filename = \"./_figures/area-level-maps.png\")\n\nSaving 7 x 5 in image",
    "crumbs": [
      "Practical",
      "Practical"
    ]
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  }
]